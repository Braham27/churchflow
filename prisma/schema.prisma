// Prisma Schema for Church Management SaaS
// Multi-tenant architecture with modular features

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== AUTHENTICATION & USERS ====================

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model User {
  id              String    @id @default(cuid())
  name            String?
  email           String?   @unique
  emailVerified   DateTime?
  image           String?
  hashedPassword  String?
  role            UserRole  @default(USER)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  accounts        Account[]
  sessions        Session[]
  churchMemberships ChurchUser[]
  notifications   Notification[]
  activityLogs    ActivityLog[]
  pushSubscriptions PushSubscription[]

  @@index([email])
}

enum UserRole {
  USER
  ADMIN
  SUPER_ADMIN
}

// ==================== CHURCH (TENANT) ====================

model Church {
  id              String   @id @default(cuid())
  name            String
  slug            String   @unique
  description     String?  @db.Text
  logo            String?
  coverImage      String?
  email           String?
  phone           String?
  website         String?
  address         String?
  city            String?
  state           String?
  country         String?
  postalCode      String?
  timezone        String   @default("UTC")
  currency        String   @default("USD")
  
  // Subscription & Billing
  subscriptionTier    SubscriptionTier @default(BASIC)
  subscriptionStatus  SubscriptionStatus @default(TRIAL)
  stripeCustomerId    String?
  stripeSubscriptionId String?
  trialEndsAt         DateTime?
  billingCycleStart   DateTime?
  
  // Feature Flags (Modular)
  enabledModules      String[] @default(["members", "events", "communications"])
  maxMembers          Int      @default(100)
  maxStorage          Int      @default(5) // in GB
  usedStorage         Float    @default(0)
  
  // Settings
  settings            Json?
  badgeSystemEnabled  Boolean  @default(false)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  users           ChurchUser[]
  members         Member[]
  families        Family[]
  groups          Group[]
  events          Event[]
  donations       Donation[]
  donationFunds   DonationFund[]
  volunteers      Volunteer[]
  volunteerRoles  VolunteerRole[]
  volunteerShifts VolunteerShift[]
  communications  Communication[]
  messageTemplates MessageTemplate[]
  attendances     Attendance[]
  checkIns        CheckIn[]
  pages           WebPage[]
  mediaFiles      MediaFile[]
  announcements   Announcement[]
  prayerRequests  PrayerRequest[]
  activityLogs    ActivityLog[]
  resources       Resource[]
  sermons         Sermon[]
  sermonSeries    SermonSeries[]
  pushSubscriptions PushSubscription[]

  @@index([slug])
  @@index([subscriptionStatus])
}

enum SubscriptionTier {
  FREE
  BASIC
  STANDARD
  PREMIUM
  ENTERPRISE
}

enum SubscriptionStatus {
  TRIAL
  ACTIVE
  PAST_DUE
  CANCELLED
  SUSPENDED
}

model ChurchUser {
  id        String   @id @default(cuid())
  userId    String
  churchId  String
  role      ChurchRole @default(MEMBER)
  joinedAt  DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  church    Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)

  @@unique([userId, churchId])
  @@index([churchId])
}

enum ChurchRole {
  OWNER
  ADMIN
  STAFF
  VOLUNTEER_LEAD
  MEMBER
}

// ==================== MEMBERS & PEOPLE ====================

model Member {
  id              String   @id @default(cuid())
  churchId        String
  
  // Personal Info
  firstName       String
  lastName        String
  middleName      String?
  email           String?
  phone           String?
  alternatePhone  String?
  dateOfBirth     DateTime?
  gender          Gender?
  maritalStatus   MaritalStatus?
  photo           String?
  
  // Address
  address         String?
  city            String?
  state           String?
  country         String?
  postalCode      String?
  
  // Church Info
  membershipStatus MembershipStatus @default(VISITOR)
  membershipDate   DateTime?
  baptismDate      DateTime?
  salvationDate    DateTime?
  weddingDate      DateTime?
  
  // Family
  familyId        String?
  familyRole      FamilyRole?
  
  // Engagement
  skills          String[]
  interests       String[]
  notes           String?  @db.Text
  
  // Badge System
  badges          String[]
  givingBadge     String?
  
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  church          Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  family          Family?  @relation(fields: [familyId], references: [id])
  groupMemberships GroupMember[]
  attendances     Attendance[]
  checkIns        CheckIn[]
  donations       Donation[]
  volunteerProfile Volunteer?
  prayerRequests  PrayerRequest[]

  @@unique([churchId, email])
  @@index([churchId])
  @@index([familyId])
  @@index([membershipStatus])
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum MaritalStatus {
  SINGLE
  MARRIED
  DIVORCED
  WIDOWED
  SEPARATED
}

enum MembershipStatus {
  VISITOR
  REGULAR_ATTENDER
  MEMBER
  INACTIVE
  TRANSFERRED
  DECEASED
}

enum FamilyRole {
  HEAD
  SPOUSE
  CHILD
  PARENT
  SIBLING
  OTHER
}

model Family {
  id          String   @id @default(cuid())
  churchId    String
  name        String
  address     String?
  phone       String?
  email       String?
  photo       String?
  notes       String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  church      Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  members     Member[]

  @@index([churchId])
}

// ==================== GROUPS ====================

model Group {
  id          String    @id @default(cuid())
  churchId    String
  name        String
  description String?   @db.Text
  category    GroupCategory @default(SMALL_GROUP)
  leaderId    String?
  photo       String?
  meetingDay  String?
  meetingTime String?
  location    String?
  capacity    Int?
  isActive    Boolean   @default(true)
  isPublic    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  church      Church    @relation(fields: [churchId], references: [id], onDelete: Cascade)
  members     GroupMember[]
  events      Event[]
  attendances Attendance[]

  @@index([churchId])
  @@index([category])
}

enum GroupCategory {
  SMALL_GROUP
  MINISTRY_TEAM
  CLASS
  COMMITTEE
  CHOIR
  YOUTH
  CHILDREN
  WOMEN
  MEN
  SENIORS
  OTHER
}

model GroupMember {
  id        String   @id @default(cuid())
  groupId   String
  memberId  String
  role      GroupMemberRole @default(MEMBER)
  joinedAt  DateTime @default(now())
  
  group     Group    @relation(fields: [groupId], references: [id], onDelete: Cascade)
  member    Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@unique([groupId, memberId])
  @@index([groupId])
  @@index([memberId])
}

enum GroupMemberRole {
  LEADER
  CO_LEADER
  MEMBER
}

// ==================== EVENTS ====================

model Event {
  id              String   @id @default(cuid())
  churchId        String
  groupId         String?
  
  title           String
  description     String?  @db.Text
  location        String?
  address         String?
  category        EventCategory @default(SERVICE)
  
  startDate       DateTime
  endDate         DateTime
  allDay          Boolean  @default(false)
  timezone        String?
  
  // Recurrence
  isRecurring     Boolean  @default(false)
  recurrenceRule  String?  // RRULE format
  parentEventId   String?
  
  // Registration
  requiresRegistration Boolean @default(false)
  registrationDeadline DateTime?
  maxAttendees    Int?
  registeredCount Int      @default(0)
  
  // Visibility
  isPublic        Boolean  @default(true)
  isPublished     Boolean  @default(true)
  publishToWebsite Boolean @default(false)
  
  // Check-in
  enableCheckIn   Boolean  @default(false)
  checkInCode     String?  @unique
  qrCodeUrl       String?
  
  // Media
  image           String?
  attachments     String[]
  
  // Live Stream
  isLiveStream    Boolean  @default(false)
  streamUrl       String?
  streamPlatform  String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  church          Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  group           Group?   @relation(fields: [groupId], references: [id])
  parentEvent     Event?   @relation("EventRecurrence", fields: [parentEventId], references: [id])
  childEvents     Event[]  @relation("EventRecurrence")
  registrations   EventRegistration[]
  attendances     Attendance[]
  checkIns        CheckIn[]
  volunteerShifts VolunteerShift[]

  @@index([churchId])
  @@index([startDate])
  @@index([category])
  @@index([checkInCode])
}

enum EventCategory {
  SERVICE
  WORSHIP
  PRAYER
  BIBLE_STUDY
  YOUTH
  CHILDREN
  OUTREACH
  FELLOWSHIP
  CONFERENCE
  CONCERT
  FUNDRAISER
  MEETING
  TRAINING
  OTHER
}

model EventRegistration {
  id          String   @id @default(cuid())
  eventId     String
  memberId    String?
  
  // Guest info (for non-members)
  guestName   String?
  guestEmail  String?
  guestPhone  String?
  
  numberOfGuests Int    @default(1)
  notes       String?
  
  // Payment (if required)
  amountPaid  Float?
  paymentStatus PaymentStatus?
  
  status      RegistrationStatus @default(REGISTERED)
  registeredAt DateTime @default(now())

  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([eventId])
  @@index([memberId])
}

enum RegistrationStatus {
  REGISTERED
  WAITLISTED
  CANCELLED
  ATTENDED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

// ==================== ATTENDANCE ====================

model Attendance {
  id          String   @id @default(cuid())
  churchId    String
  memberId    String?
  eventId     String?
  groupId     String?
  
  date        DateTime
  checkInTime DateTime?
  checkOutTime DateTime?
  
  // For headcount without member tracking
  headcount   Int?
  
  notes       String?
  recordedBy  String?
  
  createdAt   DateTime @default(now())

  church      Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  member      Member?  @relation(fields: [memberId], references: [id])
  event       Event?   @relation(fields: [eventId], references: [id])
  group       Group?   @relation(fields: [groupId], references: [id])

  @@index([churchId])
  @@index([memberId])
  @@index([eventId])
  @@index([date])
}

model CheckIn {
  id          String   @id @default(cuid())
  churchId    String
  eventId     String
  memberId    String?
  
  // Guest check-in
  guestName   String?
  
  checkInTime DateTime @default(now())
  checkInMethod CheckInMethod @default(QR_CODE)
  
  // For child check-in
  securityCode String?
  parentName   String?
  
  notes       String?

  church      Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  member      Member?  @relation(fields: [memberId], references: [id])

  @@index([churchId])
  @@index([eventId])
  @@index([checkInTime])
}

enum CheckInMethod {
  QR_CODE
  LINK
  KIOSK
  MANUAL
}

// ==================== DONATIONS ====================

model DonationFund {
  id          String   @id @default(cuid())
  churchId    String
  name        String
  description String?
  goal        Float?
  raised      Float    @default(0)
  isActive    Boolean  @default(true)
  isDefault   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  church      Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  donations   Donation[]

  @@index([churchId])
}

model Donation {
  id              String   @id @default(cuid())
  churchId        String
  memberId        String?
  fundId          String?
  
  amount          Float
  currency        String   @default("USD")
  
  // Donor info (for non-members or anonymous)
  donorName       String?
  donorEmail      String?
  isAnonymous     Boolean  @default(false)
  
  // Payment
  paymentMethod   PaymentMethod
  paymentStatus   PaymentStatus @default(PENDING)
  stripePaymentId String?
  transactionId   String?
  
  // Recurring
  isRecurring     Boolean  @default(false)
  recurringFrequency RecurringFrequency?
  stripeSubscriptionId String?
  
  // Fee handling
  coverFees       Boolean  @default(false)
  feeAmount       Float?
  netAmount       Float?
  
  notes           String?
  receiptSent     Boolean  @default(false)
  receiptSentAt   DateTime?
  
  donatedAt       DateTime @default(now())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  church          Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  member          Member?  @relation(fields: [memberId], references: [id])
  fund            DonationFund? @relation(fields: [fundId], references: [id])

  @@index([churchId])
  @@index([memberId])
  @@index([fundId])
  @@index([donatedAt])
}

enum PaymentMethod {
  CARD
  BANK_TRANSFER
  CASH
  CHECK
  TEXT_TO_GIVE
  MOBILE_APP
  KIOSK
  OTHER
}

enum RecurringFrequency {
  WEEKLY
  BIWEEKLY
  MONTHLY
  QUARTERLY
  ANNUALLY
}

// ==================== VOLUNTEERS ====================

model Volunteer {
  id              String   @id @default(cuid())
  memberId        String   @unique
  churchId        String
  
  skills          String[]
  availability    Json?    // Day/time availability
  preferredRoles  String[]
  
  backgroundCheck Boolean  @default(false)
  backgroundCheckDate DateTime?
  trainingCompleted String[]
  
  notes           String?  @db.Text
  isActive        Boolean  @default(true)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  church          Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  member          Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  shifts          VolunteerShift[]

  @@index([memberId])
  @@index([churchId])
}

model VolunteerRole {
  id          String   @id @default(cuid())
  churchId    String
  name        String
  description String?
  ministry    String?
  requiresBackgroundCheck Boolean @default(false)
  requiredTraining String[]
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())

  church      Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  shifts      VolunteerShift[]

  @@index([churchId])
}

model VolunteerShift {
  id          String   @id @default(cuid())
  churchId    String
  eventId     String?
  roleId      String
  volunteerId String?
  
  date        DateTime
  startTime   DateTime
  endTime     DateTime
  
  status      ShiftStatus @default(OPEN)
  notes       String?
  
  confirmedAt DateTime?
  reminderSent Boolean @default(false)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  church      Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  event       Event?   @relation(fields: [eventId], references: [id])
  role        VolunteerRole @relation(fields: [roleId], references: [id])
  volunteer   Volunteer? @relation(fields: [volunteerId], references: [id])

  @@index([churchId])
  @@index([eventId])
  @@index([date])
}

enum ShiftStatus {
  OPEN
  REQUESTED
  CONFIRMED
  DECLINED
  COMPLETED
  NO_SHOW
}

// ==================== COMMUNICATIONS ====================

model Communication {
  id            String   @id @default(cuid())
  churchId      String
  
  type          CommunicationType
  subject       String?
  content       String   @db.Text
  contentHtml   String?  @db.Text
  
  // Targeting
  recipientType RecipientType @default(ALL)
  recipientIds  String[]  // Member IDs or Group IDs
  
  // Scheduling
  status        CommunicationStatus @default(DRAFT)
  scheduledAt   DateTime?
  sentAt        DateTime?
  
  // Stats
  recipientCount Int      @default(0)
  openCount      Int      @default(0)
  clickCount     Int      @default(0)
  
  createdBy     String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  church        Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)

  @@index([churchId])
  @@index([status])
  @@index([sentAt])
}

enum CommunicationType {
  EMAIL
  SMS
  PUSH
  IN_APP
}

enum RecipientType {
  ALL
  MEMBERS_ONLY
  SPECIFIC_MEMBERS
  GROUPS
  VISITORS
  VOLUNTEERS
}

enum CommunicationStatus {
  DRAFT
  SCHEDULED
  SENDING
  SENT
  FAILED
}

model MessageTemplate {
  id          String   @id @default(cuid())
  churchId    String
  name        String
  category    String?
  type        CommunicationType
  subject     String?
  content     String   @db.Text
  contentHtml String?  @db.Text
  variables   String[] // Available merge fields
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  church      Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)

  @@index([churchId])
}

model Announcement {
  id          String   @id @default(cuid())
  churchId    String
  title       String
  content     String   @db.Text
  type        AnnouncementType @default(GENERAL)
  priority    Int      @default(0)
  image       String?
  link        String?
  startDate   DateTime @default(now())
  endDate     DateTime?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())

  church      Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)

  @@index([churchId])
  @@index([startDate])
}

enum AnnouncementType {
  GENERAL
  URGENT
  EVENT
  PRAYER
  CELEBRATION
}

model PrayerRequest {
  id          String   @id @default(cuid())
  churchId    String
  memberId    String?
  
  title       String?
  content     String   @db.Text
  category    String?
  
  isAnonymous Boolean  @default(false)
  isPrivate   Boolean  @default(false)
  isAnswered  Boolean  @default(false)
  answeredAt  DateTime?
  
  prayerCount Int      @default(0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  church      Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  member      Member?  @relation(fields: [memberId], references: [id])

  @@index([churchId])
  @@index([createdAt])
}

// ==================== WEBSITE BUILDER ====================

model WebPage {
  id          String   @id @default(cuid())
  churchId    String
  
  title       String
  slug        String
  content     Json     // Page builder content
  metaTitle   String?
  metaDescription String?
  
  isPublished Boolean  @default(false)
  isHomePage  Boolean  @default(false)
  
  template    String?
  order       Int      @default(0)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  church      Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)

  @@unique([churchId, slug])
  @@index([churchId])
}

// ==================== MEDIA ====================

model MediaFile {
  id          String   @id @default(cuid())
  churchId    String
  
  filename    String
  originalName String
  mimeType    String
  size        Int      // in bytes
  url         String
  thumbnailUrl String?
  
  category    MediaCategory @default(OTHER)
  description String?
  tags        String[]
  
  uploadedBy  String?
  createdAt   DateTime @default(now())

  church      Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)

  @@index([churchId])
  @@index([category])
}

enum MediaCategory {
  SERMON
  IMAGE
  VIDEO
  DOCUMENT
  AUDIO
  OTHER
}

// ==================== PUSH SUBSCRIPTIONS ====================

model PushSubscription {
  id          String   @id @default(cuid())
  churchId    String
  userId      String
  
  endpoint    String   @db.Text
  p256dh      String
  auth        String
  
  userAgent   String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  church      Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, endpoint])
  @@index([churchId])
  @@index([userId])
}

// ==================== NOTIFICATIONS & LOGS ====================

model Notification {
  id          String   @id @default(cuid())
  userId      String
  
  title       String
  message     String
  type        NotificationType @default(INFO)
  link        String?
  
  isRead      Boolean  @default(false)
  readAt      DateTime?
  
  createdAt   DateTime @default(now())

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
  REMINDER
}

model ActivityLog {
  id          String   @id @default(cuid())
  churchId    String?
  userId      String?
  
  action      String
  entityType  String
  entityId    String?
  details     Json?
  ipAddress   String?
  userAgent   String?
  
  createdAt   DateTime @default(now())

  church      Church?  @relation(fields: [churchId], references: [id], onDelete: Cascade)
  user        User?    @relation(fields: [userId], references: [id])

  @@index([churchId])
  @@index([userId])
  @@index([createdAt])
}

// ==================== RESOURCES & ROOMS ====================

model Resource {
  id          String   @id @default(cuid())
  churchId    String
  
  name        String
  description String?  @db.Text
  type        ResourceType @default(ROOM)
  capacity    Int?
  location    String?
  image       String?
  
  // Availability
  isAvailable Boolean  @default(true)
  availableFrom DateTime?
  availableTo   DateTime?
  
  // Settings
  requiresApproval Boolean @default(false)
  minBookingHours  Int?
  maxBookingHours  Int?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  church      Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  bookings    ResourceBooking[]

  @@index([churchId])
  @@index([type])
}

enum ResourceType {
  ROOM
  EQUIPMENT
  VEHICLE
  OTHER
}

model ResourceBooking {
  id          String   @id @default(cuid())
  resourceId  String
  eventId     String?
  bookedById  String?
  
  title       String
  description String?
  startTime   DateTime
  endTime     DateTime
  
  status      BookingStatus @default(PENDING)
  notes       String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  resource    Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)

  @@index([resourceId])
  @@index([startTime])
  @@index([status])
}

enum BookingStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

// ==================== SERMONS ====================

model Sermon {
  id          String   @id @default(cuid())
  churchId    String
  
  title       String
  description String?  @db.Text
  speaker     String?
  speakerId   String?  // Reference to member if internal
  
  // Date & Series
  date        DateTime
  seriesId    String?
  seriesOrder Int?
  
  // Scripture
  scripture   String?
  
  // Media
  videoUrl    String?
  audioUrl    String?
  thumbnailUrl String?
  
  // Document
  notes       String?  @db.Text
  transcript  String?  @db.Text
  slidesUrl   String?
  
  // Metrics
  viewCount   Int      @default(0)
  downloadCount Int    @default(0)
  
  // Publishing
  isPublished Boolean  @default(false)
  publishedAt DateTime?
  isFeatured  Boolean  @default(false)
  
  // Tags
  tags        String[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  church      Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  series      SermonSeries? @relation(fields: [seriesId], references: [id])

  @@index([churchId])
  @@index([date])
  @@index([seriesId])
}

model SermonSeries {
  id          String   @id @default(cuid())
  churchId    String
  
  title       String
  description String?  @db.Text
  imageUrl    String?
  
  startDate   DateTime?
  endDate     DateTime?
  
  isActive    Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  church      Church   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  sermons     Sermon[]

  @@index([churchId])
}
